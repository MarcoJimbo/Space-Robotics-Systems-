function[M] = mass_matrix(q)

    %%% function che in funzione delle variabili di giunto costruisce la
    %%% matrice di massa del manipolatore. IMPORTANTE va aggiornata
    %%% l'espressione ogni volta che vengono cambiate le caratteristiche
    %%% fisiche del manipolatore.

    % INPUT:
    % q:                    double [nx1] = variabili di giunto

    % OUTPUT:
    % M:                    double [nxn] = matrice di massa

    % estrazione componenti input
    q1 = q(1);
    q2 = q(2);
    q3 = q(3);
    q4 = q(4);
    q5 = q(5);
    
    % determinazione matrice di massa
    M = [(197421*cos(2*q2 + q3))/200000 + (1652514097894370458901*cos(2*q2 + 2*q3 + 2*q4 + 2*q5))/288230376151711744000000 + (28203*cos(q3 + q4 + q5))/500000 + (273028985056712482902933*cos(2*q2))/288230376151711744000000 + (8039555118228226850069*cos(2*q2 + 2*q3 + 2*q4))/288230376151711744000000 + (4029*cos(2*q2 + 2*q3 + q4 + q5))/100000 + (7156071945708752315857*cos(2*q2 + 2*q3))/23058430092136939520000 + (84609*cos(2*q2 + q3 + q4))/400000 + (84609*cos(q3 + q4))/400000 + (4029*cos(q4 + q5))/100000 + (4029*cos(2*q2 + 2*q3 + 2*q4 + q5))/250000 + (197421*cos(q3))/200000 + (12087*cos(q4))/80000 + (4029*cos(q5))/250000 + (12087*cos(2*q2 + 2*q3 + q4))/80000 + (28203*cos(2*q2 + q3 + q4 + q5))/500000 + 745226497423203124851481/576460752303423488000000,                                                                                                                                                                                       0,                                                                                                                                                                                    0,                                                                                                                                                             0,                                                                                                   0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0, (28203*cos(q3 + q4 + q5))/250000 + (84609*cos(q3 + q4))/200000 + (4029*cos(q4 + q5))/50000 + (197421*cos(q3))/100000 + (12087*cos(q4))/40000 + (4029*cos(q5))/125000 + 10335971/4000000, (28203*cos(q3 + q4 + q5))/500000 + (253827*cos(q3 + q4))/1000000 + (4029*cos(q4 + q5))/50000 + (84609*cos(q3))/80000 + (12087*cos(q4))/40000 + (4029*cos(q5))/125000 + 551043/800000, (28203*cos(q3 + q4 + q5))/500000 + (253827*cos(q3 + q4))/1000000 + (4029*cos(q4 + q5))/100000 + (36261*cos(q4))/200000 + (4029*cos(q5))/125000 + 13527/200000, (28203*cos(q3 + q4 + q5))/500000 + (4029*cos(q4 + q5))/100000 + (4029*cos(q5))/250000 + 5829/500000;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,    (28203*cos(q3 + q4 + q5))/500000 + (84609*cos(q3 + q4))/500000 + (4029*cos(q4 + q5))/50000 + (366639*cos(q3))/400000 + (12087*cos(q4))/40000 + (4029*cos(q5))/125000 + 551043/800000,                                                                                            (4029*cos(q4 + q5))/50000 + (12087*cos(q4))/40000 + (4029*cos(q5))/125000 + 551043/800000,                                                                    (4029*cos(q4 + q5))/100000 + (36261*cos(q4))/200000 + (4029*cos(q5))/125000 + 13527/200000,                                    (4029*cos(q4 + q5))/100000 + (4029*cos(q5))/250000 + 5829/500000;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                             (28203*cos(q3 + q4 + q5))/500000 + (84609*cos(q3 + q4))/500000 + (4029*cos(q4 + q5))/100000 + (12087*cos(q4))/100000 + (4029*cos(q5))/125000 + 13527/200000,                                                                                           (4029*cos(q4 + q5))/100000 + (12087*cos(q4))/100000 + (4029*cos(q5))/125000 + 13527/200000,                                                                                                                          (4029*cos(q5))/125000 + 13527/200000,                                                                 (4029*cos(q5))/250000 + 5829/500000;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0,                                                                                     (28203*cos(q3 + q4 + q5))/500000 + (4029*cos(q4 + q5))/100000 + (4029*cos(q5))/250000 + 5829/500000,                                                                                                                     (4029*cos(q4 + q5))/100000 + (4029*cos(q5))/250000 + 5829/500000,                                                                                                                           (4029*cos(q5))/250000 + 5829/500000,                                                                                         5829/500000];
    % fine matrice
          
end